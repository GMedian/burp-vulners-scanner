package burp.models;

import com.google.common.collect.Lists;
import org.json.JSONArray;
import org.json.JSONObject;

import java.util.HashSet;
import java.util.List;
import java.util.Set;

public class PathVulnerability extends Vulnerability {

    private List<String[]> exploits;
    private String parameter;
    private String url;
    private String position;
    //description
    private List<String> cwe=Lists.newArrayList();

    private PathVulnerability(){}


    public static PathVulnerability fromWebVulns(String cveId, JSONObject webVulnBulletin){
        PathVulnerability vulnerability = new PathVulnerability();

        vulnerability.setId(cveId);

        vulnerability.setParameter(webVulnBulletin.optString("parameter",""));
        vulnerability.setUrl(webVulnBulletin.optString("url",""));
        vulnerability.setPosition(webVulnBulletin.optString("position",""));
        vulnerability.setDescription(webVulnBulletin.optString("description",""));
//        vulnerability.setCwe(webVulnBulletin.optJSONArray("parameter",[]));

        webVulnBulletin.optJSONArray("cwe").forEach(cwe -> {
            vulnerability.cwe.add((String) cwe);
        });

        return vulnerability;
    }

    private void searchForExploits(){

    }

//    public String getItemLink() {
//        return getItemLink(id);
//    }
//
//    public String getItemLink(String value) {
//        return String.format("<a href=\"https://vulners.com/%s/%s\" target=\"_blank\">%s</a>", type, id, value);
//    }
//
//    public void update(JSONObject vulnersIDBulletin) {
//        this.id = vulnersIDBulletin.optString("id", this.id);
//        this.type = vulnersIDBulletin.optString("type", this.type);
//        this.title = vulnersIDBulletin.optString("title", this.title);
//        this.description = vulnersIDBulletin.optString("description", this.description);
//
//        this.cvssScore = vulnersIDBulletin.optJSONObject("metrics", new JSONObject()).optJSONObject("cvss", new JSONObject()).optDouble("score", this.cvssScore);
//    }
//
//    public String getItemDescription() {
//        return description.length() > 256
//                ? description.substring(0, 256) + "..."
//                : description;
//    }

    @Override
    public void setExploits(List<String[]> exploits) {
        this.exploits = exploits;
    }

    public String getParameter() {
        return parameter;
    }

    public void setParameter(String parameter) {
        this.parameter = parameter;
    }

    public String getUrl() {
        return url;
    }

    public void setUrl(String url) {
        this.url = url;
    }

    public String getPosition() {
        return position;
    }

    public void setPosition(String position) {
        this.position = position;
    }

}
